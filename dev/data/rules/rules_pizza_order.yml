version: "3.1"

rules:
- rule: Activate Pizza Form
  steps:
  - or:
    - intent: inform_pizza_order
    - intent: buy_pizza
  - action: pizza_order_form
  - active_loop: pizza_order_form 
    

#### submit pizza order form by adding all to total_order, ask for more orders
- rule: Submit Pizza Form and Add More Orders
  condition:
  - active_loop: pizza_order_form
  steps:
  - action: pizza_order_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_total_order_add
  - action: utter_anything_else
  - or:
    - intent: affirm
    - intent: add_more_pizza
  - action: action_reset_slots
  - action: action_listen


#### sumit pizza order form by adding all to total_order, ask for more orders, no more orders
- rule: Submit Pizza Form Finish Order
  condition:
  - active_loop: pizza_order_form
  steps:
  - action: pizza_order_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: action_total_order_add
  - action: utter_anything_else
  - intent: deny
  - action: utter_all_set
  - action: utter_order_final



#### continues the form after bot challange
- rule: Interruption in Pizza Form
  condition:
  # Condition that form is active.
  - active_loop: pizza_order_form
  steps:
  # This unhappy path handles logic for bot challange and restaurant info
  - intent: faq
  - action: utter_faq
  # Return to form after handling the faq intent
  - action: pizza_order_form
  - active_loop: pizza_order_form

####  interrupts the normal flow with telling the pizza sizes
- rule: Explain Pizza Size
  condition:
  - active_loop: pizza_order_form
  steps:
  - intent: what_size_you_have
  - action: action_pizza_size_information
  - action: pizza_order_form
  - active_loop: pizza_order_form

#TODO: think of general grouping like faq for size, type and crust?

#### continues the form after bot challange
- rule: Out of Scope in Pizza Form
  condition:
  # Condition that form is active.
  - active_loop: pizza_order_form
  steps:
  # This unhappy path handles logic for out of scope user input
  - intent: out_of_scope
  - action: utter_out_of_scope
  # Return to form after handling the faq intent
  - action: pizza_order_form
  - active_loop: pizza_order_form